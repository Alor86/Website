<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AI Game Builder â€” Demo (Phase 2)</title>
<link rel="icon" href="data:,">
<style>
  /* -------------------------
     THEME & LAYOUT
     ------------------------- */
  :root{
    --bg:#071220; --card:#0b1622; --muted:#9fb6c8; --accent:#ff7a18; --glass: rgba(255,255,255,0.04);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial; background: linear-gradient(180deg,#03131b 0%, #071a26 100%); color:#e8f6ff; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale}
  .wrap{max-width:1100px;margin:0 auto;padding:14px;display:grid;gap:14px; grid-template-columns:1fr; min-height:calc(100vh - 28px)}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#ffb17a,#ff7a18);box-shadow:0 6px 20px rgba(255,122,24,0.14)}
  h1{margin:0;font-size:18px}
  .device{font-size:12px;color:var(--muted)}

  /* top controls */
  .controls{display:flex;gap:8px;align-items:center}
  button, .fake-btn{background:var(--accent);border:none;padding:10px 12px;border-radius:10px;color:#07121a;font-weight:700;cursor:pointer}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:8px 10px;border-radius:10px}
  .small{font-size:13px;color:var(--muted)}

  /* grid content */
  .mainGrid{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:980px){ .mainGrid{grid-template-columns:2fr 1fr} }

  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03)}
  .card h3{margin:0 0 8px 0}

  /* question area */
  #aiArea .question{font-weight:700;font-size:16px;color:#dff7ff}
  textarea{width:100%;min-height:96px;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit;resize:vertical}
  .q-actions{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}

  /* preview */
  .preview{background:#061322;border-radius:10px;padding:12px;text-align:center;border:1px solid rgba(255,255,255,0.03)}
  .preview img{max-width:100%;border-radius:8px;display:block;margin:8px auto}
  .preview .meta{color:var(--muted);font-size:13px}

  /* HUD phone */
  .hudPhone{width:180px;height:320px;background:linear-gradient(180deg,#05111b,#07202a);margin:10px auto;border-radius:14px;border:1px solid rgba(255,255,255,0.02);position:relative;overflow:hidden;box-shadow:0 8px 26px rgba(3,11,20,0.5)}
  .hudBtn{position:absolute;background:linear-gradient(180deg,#ffd7b8,#ff7a18);color:#07121a;font-weight:800;border-radius:12px;display:flex;align-items:center;justify-content:center;user-select:none;touch-action:none;box-shadow:0 6px 18px rgba(0,0,0,0.25)}

  /* animated compliment */
  .compliment{padding:8px;border-radius:10px;background:linear-gradient(90deg,#072b2b,#063d3d);color:#bfffe1;font-weight:700;display:inline-block;transform-origin:left;animation:popIn .36s ease}
  @keyframes popIn{from{transform:scale(.95);opacity:0}to{transform:scale(1);opacity:1}}

  /* login popup */
  #loginModal{position:fixed;inset:0;background:linear-gradient(180deg, rgba(1,6,10,0.6), rgba(1,6,10,0.6));display:flex;align-items:center;justify-content:center;z-index:999}
  .modalBox{width:320px;background:#061725;padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);text-align:center}
  .finger{width:92px;height:92px;margin:12px auto;background:url('https://i.ibb.co/T8B3bnP/fingerprint.png') center/cover;animation:scan 1s linear infinite}
  @keyframes scan{0%{transform:scale(1);filter:brightness(.9)}50%{transform:scale(1.06);filter:brightness(1.4)}100%{transform:scale(1);filter:brightness(.9)}}
  .scanText{color:var(--muted);font-size:13px;margin-top:6px}
  .successCircle{width:64px;height:64px;border-radius:50%;border:4px solid #2ed573;margin:12px auto;display:none;animation:pop .36s ease}

  /* footer */
  footer{padding:12px;text-align:center;color:var(--muted);font-size:13px}

  /* micro interactions */
  .fadeIn{animation:fadeIn .28s ease}
  @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

  /* responsive adjustments */
  @media(max-width:520px){
    .hudPhone{transform:scale(.86);margin:4px auto}
    .modalBox{width:92%}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>AI Game Builder â€” Demo</h1>
          <div class="device small">Device: <code id="deviceId"></code></div>
        </div>
      </div>
      <div class="controls">
        <div id="signedAs" class="small">Guest</div>
        <button class="btn-ghost" onclick="openLogin()">Sign In</button>
        <button onclick="openDashboard()">Dashboard</button>
      </div>
    </header>

    <main class="mainGrid">
      <!-- Left / Creator -->
      <section class="card" id="aiArea">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h3>Guided Game Creator</h3>
            <div class="small">The AI will ask adaptive questions â€” finish quickly or fine-tune later.</div>
          </div>
          <div style="text-align:right">
            <div class="small">Progress <span id="progCount">0</span>/<span id="progMax">20</span></div>
            <div style="margin-top:8px">
              <button id="freeBtn" class="ghost" onclick="startFreeTrial()">Use once free</button>
              <button onclick="buyPremium()" style="margin-left:8px">Buy Premium â‚¹99</button>
            </div>
          </div>
        </div>

        <hr style="border:none;height:1px;background:rgba(255,255,255,0.02);margin:12px 0">

        <div id="complimentWrap" style="min-height:28px"></div>

        <div style="margin-top:10px">
          <div class="question" id="questionText">Tell me the theme or mood â€” fantasy, cyberpunk, gangster, etc.</div>
          <textarea id="answerInput" placeholder="Type or use quick chips..."></textarea>
          <div class="q-actions">
            <button onclick="saveAnswer()">Save & Next</button>
            <button class="btn-ghost" onclick="openMore()">Didn't describe properly</button>
            <button class="btn-ghost" onclick="skipQ()">Skip</button>
            <div style="flex:1"></div>
            <div class="small">AI mode: <b>local-demo</b></div>
          </div>
        </div>

        <div style="margin-top:12px">
          <div class="small">Quick choices</div>
          <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
            <div class="btn-ghost" onclick="quickFill('Fantasy')">Fantasy</div>
            <div class="btn-ghost" onclick="quickFill('Cyberpunk')">Cyberpunk</div>
            <div class="btn-ghost" onclick="quickFill('Gangster')">Gangster</div>
            <div class="btn-ghost" onclick="quickFill('Racing')">Racing</div>
            <div class="btn-ghost" onclick="quickFill('Puzzle')">Puzzle</div>
          </div>
        </div>

        <div style="margin-top:14px">
          <div class="small">Draft Summary</div>
          <div id="summary" style="margin-top:8px;color:#dff7ff"></div>
        </div>
      </section>

      <!-- Right / Preview & HUD -->
      <aside>
        <div class="card preview">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><strong>Instant Preview</strong></div>
            <div class="small">Live</div>
          </div>
          <img id="previewImg" src="" alt="preview" style="display:none" />
          <div id="previewText" class="meta">Preview will show after theme & title</div>

          <div style="margin-top:12px">
            <div style="display:flex;gap:8px;align-items:center">
              <button class="btn-ghost" onclick="runPlayable()">Play Demo</button>
              <button onclick="finalizeGame()">Finalize</button>
            </div>
          </div>

          <hr style="margin:12px 0;border:none;height:1px;background:rgba(255,255,255,0.02)">

          <div style="font-weight:700;margin-bottom:6px">HUD Editor</div>
          <div class="hudPhone" id="hudPhone"></div>
          <div style="display:flex;gap:8px;margin-top:8px;justify-content:center">
            <button onclick="addHud()">Add HUD Button</button>
            <button class="btn-ghost" onclick="clearHud()">Clear HUD</button>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><strong>Account & Activity</strong></div>
            <div class="small" id="accState">Guest</div>
          </div>
          <div style="margin-top:8px" id="activityBox"></div>
          <div style="margin-top:10px;display:flex;gap:8px">
            <button class="btn-ghost" onclick="downloadJSON()">Download JSON</button>
            <button class="btn-ghost danger" onclick="resetDemo()">Reset Demo</button>
          </div>
        </div>
      </aside>
    </main>

    <footer>Demo â€” frontend-only. Payments, AI, and publishing are placeholders for now.</footer>
  </div>

  <!-- LOGIN / VERIFY Modal -->
  <div id="loginModal" style="display:none">
    <div class="modalBox">
      <div style="font-weight:800">Verify your account</div>
      <div class="finger" id="finger"></div>
      <div class="scanText" id="scanText">Tap fingerprint to scan</div>
      <div class="successCircle" id="successCircle"></div>
      <input id="loginEmail" placeholder="Your email (optional)" style="width:90%;margin-top:8px;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit"/>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button onclick="startFingerprint()">ðŸ”’ Fingerprint</button>
        <button class="btn-ghost" onclick="sendOtp()">ðŸ“© Send OTP</button>
      </div>
      <div style="margin-top:8px">
        <input id="otpField" placeholder="Enter OTP (demo:1234)" style="width:90%;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit"/>
        <div style="margin-top:8px"><button onclick="verifyOtp()">Verify</button></div>
      </div>
      <div style="margin-top:10px"><button class="btn-ghost" onclick="closeLogin()">Close</button></div>
    </div>
  </div>

<script>
/* ---------------------------
   Demo Phase 2 â€” client-only
   --------------------------- */

const DEVICE_KEY = 'ag_demo_device_v2';
const TRIAL_USED_KEY = 'ag_demo_trial_used_v2';
const STATE_KEY = 'ag_demo_state_v2';

function getDeviceId(){
  let id = localStorage.getItem(DEVICE_KEY);
  if(!id){ id = 'dev-'+Math.random().toString(36).slice(2,10)+'-'+Date.now().toString(36); localStorage.setItem(DEVICE_KEY,id); }
  return id;
}
document.getElementById('deviceId').innerText = getDeviceId();

/* state */
let state = JSON.parse(localStorage.getItem(STATE_KEY) || '{}');
if(!state.answers) state.answers = {};
if(!state.hud) state.hud = {elements:[]};
if(!state.activity) state.activity = [];
if(!state.user) state.user = null;
saveState();

const QUESTIONS = [
  {k:'theme', q:'Theme / setting (fantasy, cyberpunk, gangster, space)'},
  {k:'name', q:'Game name (title)'},
  {k:'genre', q:'Genre (platformer, shooter, racing, puzzle)'},
  {k:'platform', q:'Target platform (Web, Android, iOS)'},
  {k:'controls', q:'Primary controls (tap, swipe, joystick)'},
  {k:'core', q:'One-sentence core loop (what player does)'},
  {k:'player', q:'Player character (appearance & abilities)'},
  {k:'enemies', q:'Enemies / obstacles'},
  {k:'levels', q:'Level structure (levels / endless)'},
  {k:'art', q:'Art style (pixel, vector, 2D sprites)'},
  {k:'sound', q:'Music vibe'},
  {k:'hud', q:'HUD style (minimal / detailed)'},
  {k:'monetize', q:'Monetization (ads / premium / IAP)'},
  {k:'social', q:'Leaderboards / share features'},
  {k:'export', q:'Export target (Unity / Unreal / Web)'}
];
let currentQIndex = 0;

/* helpers */
function saveState(){ localStorage.setItem(STATE_KEY, JSON.stringify(state)); renderSummary(); renderActivity(); renderHud(); updateUI(); }
function pushActivity(type, detail=''){ state.activity.unshift({type, detail, ts: new Date().toISOString()}); saveState(); }
function updateUI(){
  document.getElementById('signedAs').innerText = state.user ? state.user.email : 'Guest';
  document.getElementById('accState').innerText = state.user ? (state.user.premium ? 'Premium' : 'Signed In') : 'Guest';
  document.getElementById('progMax').innerText = QUESTIONS.length;
  document.getElementById('progCount').innerText = Object.keys(state.answers).length;
  document.getElementById('accState').innerText = state.user ? state.user.email : 'Guest';
}

/* UI renderers */
function renderSummary(){
  const s = document.getElementById('summary');
  const entries = Object.entries(state.answers);
  if(entries.length===0){ s.innerHTML = '<div class="small">No answers yet</div>'; return; }
  s.innerHTML = entries.map(([k,v])=>`<div style="margin:6px 0"><b>${k}</b>: ${escapeHtml(v)} <button class="btn-ghost" onclick="editSlot('${k}')">Edit</button></div>`).join('');
}
function renderActivity(){
  const el = document.getElementById('activityBox');
  el.innerHTML = state.activity.slice(0,10).map(a=>`<div style="margin-bottom:8px"><b>${a.type}</b> ${a.detail?('- '+escapeHtml(a.detail)) : ''} <div class="small">${new Date(a.ts).toLocaleString()}</div></div>`).join('');
}
function renderHud(){
  const phone = document.getElementById('hudPhone');
  phone.innerHTML = '';
  state.hud.elements.forEach(el=>{
    const d = document.createElement('div');
    d.className = 'hudBtn';
    d.style.left = (el.x||20)+'px';
    d.style.top = (el.y||200)+'px';
    d.style.width = (el.w||54)+'px';
    d.style.height = (el.h||40)+'px';
    d.style.fontSize = '12px';
    d.textContent = el.label || 'BTN';
    d.style.position='absolute';
    // pointer drag
    let sx, sy, ox, oy;
    d.addEventListener('pointerdown', (ev)=>{
      ev.preventDefault(); d.setPointerCapture(ev.pointerId);
      sx = ev.clientX; sy = ev.clientY; ox = parseInt(d.style.left); oy = parseInt(d.style.top);
      function move(m){ const nx = ox + (m.clientX - sx); const ny = oy + (m.clientY - sy); d.style.left = Math.max(4, Math.min(110,nx))+'px'; d.style.top = Math.max(4, Math.min(260,ny))+'px'; }
      function up(){ d.releasePointerCapture(ev.pointerId); window.removeEventListener('pointermove', move); window.removeEventListener('pointerup', up); const idx = state.hud.elements.findIndex(x=>x.id===el.id); if(idx>=0){ state.hud.elements[idx].x = parseInt(d.style.left); state.hud.elements[idx].y = parseInt(d.style.top); saveState(); } }
      window.addEventListener('pointermove', move); window.addEventListener('pointerup', up);
    });
    phone.appendChild(d);
  });
}

/* question logic (local planner) */
function initQuestions(){
  const next = QUESTIONS.findIndex(q=> !state.answers[q.k]);
  currentQIndex = next>=0 ? next : QUESTIONS.length;
  askNext();
}
function askNext(){
  if(currentQIndex >= QUESTIONS.length){
    setQuestion('All done â€” ready to finalize?');
    document.getElementById('answerInput').value = '';
    return;
  }
  const q = QUESTIONS[currentQIndex];
  setQuestion(q.q);
  document.getElementById('answerInput').value = '';
}
function setQuestion(text){ document.getElementById('questionText').innerText = text; }
function saveAnswer(){
  const val = document.getElementById('answerInput').value.trim();
  if(!val){ alert('Type an answer or use quick chips'); return; }
  if(currentQIndex >= QUESTIONS.length){ alert('No active question'); return; }
  const key = QUESTIONS[currentQIndex].k;
  state.answers[key] = val;
  pushActivity('answered', `${key}: ${val}`);
  compliment('Nice! That helps a lot.');
  // preview on name/theme/art
  if(key==='name' || key==='theme' || key==='art') generatePreview();
  currentQIndex = QUESTIONS.findIndex(q=> !state.answers[q.k]);
  if(currentQIndex < 0) currentQIndex = QUESTIONS.length;
  saveState();
  askNext();
}
function skipQ(){ if(currentQIndex < QUESTIONS.length){ const key = QUESTIONS[currentQIndex].k; state.answers[key] = 'SKIPPED'; pushActivity('skipped', key); saveState(); currentQIndex = QUESTIONS.findIndex(q=> !state.answers[q.k]); if(currentQIndex < 0) currentQIndex = QUESTIONS.length; askNext(); } }
function openMore(){ const detail = prompt('Give extra detail or sample (e.g., "rainy neon city with cars")'); if(detail){ if(currentQIndex<QUESTIONS.length){ state.answers[QUESTIONS[currentQIndex].k] = detail; pushActivity('clarified', detail); compliment('Great detail â€” that will improve the preview.'); saveState(); currentQIndex = QUESTIONS.findIndex(q=> !state.answers[q.k]); if(currentQIndex < 0) currentQIndex = QUESTIONS.length; askNext(); } } }
function quickFill(v){ document.getElementById('answerInput').value = v; }

/* preview generation (placeholder) */
function generatePreview(){
  const name = state.answers.name || 'Untitled';
  const theme = state.answers.theme || state.answers.art || 'mysterious';
  const url = `https://dummyimage.com/720x360/071b24/9dd2ff&text=${encodeURIComponent(name+' - '+theme)}`;
  document.getElementById('previewImg').src = url;
  document.getElementById('previewImg').style.display='block';
  document.getElementById('previewText').innerText = `${name} â€” ${theme}`;
}

/* compliments */
function compliment(msg){
  const wrap = document.getElementById('complimentWrap');
  wrap.innerHTML = `<div class="compliment fadeIn">${msg||'Nice choice!'}</div>`;
  setTimeout(()=>{ wrap.innerHTML = ''; },2200);
}

/* HUD actions */
function addHud(){
  const id = 'h'+Math.random().toString(36).slice(2,9);
  state.hud.elements.push({id,label:'BTN',x:20,y:200,w:56,h:38});
  pushActivity('hud_add', id); saveState(); renderHud();
}
function clearHud(){ state.hud = {elements:[]}; pushActivity('hud_clear'); saveState(); renderHud(); }

/* finalize & download project */
function finalizeGame(){
  const ok = confirm('Finalize and download project JSON?');
  if(!ok) return;
  pushActivity('finalize', state.answers.name||'Untitled');
  downloadJSON();
  alert('Project JSON downloaded (demo).');
}
function downloadJSON(){
  const payload = {
    meta:{ device:getDeviceId(), user: state.user || null, createdAt: new Date().toISOString() },
    answers: state.answers,
    hud: state.hud
  };
  const blob = new Blob([JSON.stringify(payload,null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = (state.answers.name || 'game') + '-project.json'; a.click();
}

/* playable demo stub */
function runPlayable(){ alert('Playable demo (placeholder) â€” in production this runs an HTML5 prototype.'); pushActivity('play_demo'); }

/* Dashboard & reset */
function openDashboard(){ window.scrollTo({top:0,behavior:'smooth'}); renderActivity(); alert('Dashboard open (scroll up)'); }
function resetDemo(){ if(!confirm('Reset demo data on this device?')) return; localStorage.removeItem(STATE_KEY); localStorage.removeItem(TRIAL_USED_KEY); location.reload(); }

/* login modal behavior */
function openLogin(){ document.getElementById('loginModal').style.display='flex'; }
function closeLogin(){ document.getElementById('loginModal').style.display='none'; }
function startFingerprint(){
  const finger = document.getElementById('finger'); const scanText = document.getElementById('scanText'); const success = document.getElementById('successCircle');
  finger.style.display='block'; success.style.display='none'; scanText.innerText='Scanning fingerprint...';
  if(navigator.vibrate) navigator.vibrate([50,50,50]);
  setTimeout(()=>{ finger.style.display='none'; success.style.display='block'; if(navigator.vibrate) navigator.vibrate([120]); setTimeout(()=>{ finishLogin(); },900); }, 2200);
}
function sendOtp(){ alert('Demo OTP is 1234 â€” auto-filled.'); document.getElementById('otpField').value='1234'; }
function verifyOtp(){ if(document.getElementById('otpField').value.trim()==='1234'){ finishLogin(); } else alert('Wrong demo OTP'); }
function finishLogin(){
  const em = document.getElementById('loginEmail').value.trim() || ('user'+Math.floor(Math.random()*99)+'@demo');
  state.user = { email: em, premium: false, signedAt: new Date().toISOString(), device: getDeviceId() };
  pushActivity('signin', em); saveState(); closeLogin(); alert('Signed in as '+em);
}

/* trial enforcement */
function startFreeTrial(){
  const used = JSON.parse(localStorage.getItem(TRIAL_USED_KEY) || '[]');
  const dev = getDeviceId();
  if(used.includes(dev)){ alert('Free trial on this device already used. Please buy Premium to continue.'); return; }
  used.push(dev); localStorage.setItem(TRIAL_USED_KEY, JSON.stringify(used));
  pushActivity('trial_start', dev); saveState(); compliment('Free trial started â€” enjoy creating!');
}

/* premium simulation */
function buyPremium(){
  if(!state.user){ if(confirm('Sign in to buy premium?')) openLogin(); return; }
  state.user.premium = true; pushActivity('purchase', 'Premium â‚¹99/month (demo)'); saveState(); alert('Premium activated (demo)');
}

/* misc helpers */
function editSlot(k){ const val = prompt('Edit answer for '+k, state.answers[k]||''); if(val!==null){ state.answers[k] = val; pushActivity('edit', `${k}:${val}`); saveState(); } }
function skipToEnd(){ currentQIndex = QUESTIONS.length; askNext(); }
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch])); }
function getDeviceId(){ return getDeviceIdLocal(); }
function getDeviceIdLocal(){ return localStorage.getItem(DEVICE_KEY) || getDeviceId(); }

/* initialize UI */
initQuestions();
renderHud();
renderActivity();
updateUI();

/* small safety: ensure question UI in sync */
function initQuestions(){ askNext(); renderSummary(); updateUI(); }
function askNext(){ const next = QUESTIONS.findIndex(q=> !state.answers[q.k]); currentQIndex = next>=0 ? next : QUESTIONS.length; askNextInner(); }
function askNextInner(){ if(currentQIndex>=QUESTIONS.length){ setQuestion('All done â€” ready to finalize?'); document.getElementById('answerInput').value=''; } else { setQuestion(QUESTIONS[currentQIndex].q); document.getElementById('answerInput').value=''; } updateUI(); }

/* ensure state saved on unload */
window.addEventListener('beforeunload', ()=> saveState());

</script>
</body>
</html>
